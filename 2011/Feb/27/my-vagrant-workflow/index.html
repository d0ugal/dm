<!DOCTYPE html>
<html>
<head>

  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>

  <meta name="viewport" content="width=device-width,initial-scale=1">

  <link rel="icon" href="/theme/img/favicon.ico" type="image/x-icon" />
  <link rel="stylesheet" href="/theme/css/bootstrap.css" type="text/css" media="screen, projection" />
  <link rel="stylesheet" href="/theme/css/bootstrap-responsive.css" type="text/css" media="screen, projection" />
  <link href='http://fonts.googleapis.com/css?family=Lato:regular|PT+Serif+Caption|PT+Serif|Droid+Sans+Mono' rel='stylesheet' type='text/css'>
  <link href="/theme/css/monokai.css" rel="stylesheet" type="text/css" />
  <link href="/theme/css/style.css" rel="stylesheet" type="text/css" />

  <link rel="apple-touch-icon" href="/apple-touch-icon.png" />
  <link rel="apple-touch-icon" sizes="57x57" href="/theme/img/iconified/apple-touch-icon-57x57.png" />
  <link rel="apple-touch-icon" sizes="60x60" href="/theme/img/iconified/apple-touch-icon-60x60.png" />
  <link rel="apple-touch-icon" sizes="72x72" href="/theme/img/iconified/apple-touch-icon-72x72.png" />
  <link rel="apple-touch-icon" sizes="76x76" href="/theme/img/iconified/apple-touch-icon-76x76.png" />
  <link rel="apple-touch-icon" sizes="114x114" href="/theme/img/iconified/apple-touch-icon-114x114.png" />
  <link rel="apple-touch-icon" sizes="120x120" href="/theme/img/iconified/apple-touch-icon-120x120.png" />
  <link rel="apple-touch-icon" sizes="144x144" href="/theme/img/iconified/apple-touch-icon-144x144.png" />
  <link rel="apple-touch-icon" sizes="152x152" href="/theme/img/iconified/apple-touch-icon-152x152.png" />

  <title>My Vagrant Workflow - Dougal Matthews</title>
  <meta charset="utf-8" />
  <link href="http://www.dougalmatthews.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Dougal Matthews Full Atom Feed" />

  <meta name="google-site-verification" content="IcOvKAxyUFNerZzvGS3tYBfHaQUhutWsnQrNZ8SDHrE" />
  <meta name="verify-v1" content="d4ZT12Eg5dza8IxtDZlqiZoC0EzBnLxeYeK2PTiaIrU=" />
  <meta name="msvalidate.01" content="08FE3976E4596314289973311F691DC2" />
  <meta name="y_key" content="ef34f6756bc76371" />

  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


</head>
<body>

  <div class="navbar">
    <div class="navbar-inner">
      <div class="navbar-centre">
        <a class="brand" href="/"><span class="red">Dougal</span> <span class="white">Matthews</span></a>
        <ul class="nav">
            <li ><a href="/code/">Code</a></li>
            <!--<li ><a href="/projects/">Projects</a></li>-->
            <li ><a href="/work/">Work</a></li>
            <li ><a href="/talks/">Talks</a></li>
            <li ><a href="/about/">About</a></li>
        <ul class="nav">
      </div>
    </div>
  </div>

  <div id="content_wrapper">

    <div id="content" class="container prepent-top">

<section id="content" class="body">
  <div class="entry-content">
    <div class="row">
      <div class="span8">
        <header>
          <h2 class="entry-title">
            <a href="http://www.dougalmatthews.com/2011/Feb/27/my-vagrant-workflow/" rel="bookmark"
              title="Permalink to My Vagrant Workflow">My Vagrant Workflow</a></h2>
        </header>
        <footer class="post-info">
          <time datetime="2011-02-27T19:25:00+00:00">
            Sun 27 February 2011
          </time>
        </footer><!-- /.post-info -->
        <p><a class="reference external" href="http://vagrantup.com">Vagrant</a> is a command line tool for managing virtual machines aimed at
virtualising your development environment. It is essentially a wrapper around
Oracle's <a class="reference external" href="http://www.virtualbox.org">VirtualBox</a> but a very good one.</p>
<p>Getting started is really easy, there is a good quick start on the Vagrant
website, or you can try my version to get a development environment I've been
using - which is a basic box with some Python tools and postgres. Vagrant
projects are initialised for a directory and simply contains a file called
Vagrantfile (and an automatically generated .vagrant file). Generally speaking
I would then do this once in each project root allowing the vagrant file to
be version controlled and configured for an individual project. Then each
developer can create a virtual machine from the same config and this keeps
everybody on the same page.</p>
<div class="highlight"><pre><span></span>sudo gem update --system
gem install vagrant
cd /path/to/project
vagrant init
</pre></div>
<p>You may not need the first step there, but I did on my mac. There is a
detailed setup guide for different platforms <a class="reference external" href="http://vagrantup.com/docs/getting-started/index.html">here</a>. So if you have
any problems make sure you read that first.</p>
<p>In your current directory you should now have a file named <cite>Vagrantfile</cite>. This
is a simple Ruby based configuration file. The Vagrantfile is
<a class="reference external" href="http://vagrantup.com/docs/vagrantfile.html">well documented</a> so we'll skip past that bit. Instead, copy the following
into your vagrant file.</p>
<div class="highlight"><pre><span></span><span class="no">Vagrant</span><span class="o">::</span><span class="no">Config</span><span class="o">.</span><span class="n">run</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>

  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">box</span> <span class="o">=</span> <span class="s2">&quot;lucid32&quot;</span>
  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">box_url</span> <span class="o">=</span> <span class="s2">&quot;http://files.vagrantup.com/lucid32.box&quot;</span>

  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">forward_port</span><span class="p">(</span><span class="s2">&quot;web&quot;</span><span class="p">,</span> <span class="mi">8000</span><span class="p">,</span> <span class="mi">8000</span><span class="p">)</span>
  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">network</span><span class="p">(</span><span class="s2">&quot;33.33.00.10&quot;</span><span class="p">)</span>

  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="ss">:chef_solo</span> <span class="k">do</span> <span class="o">|</span><span class="n">chef</span><span class="o">|</span>

    <span class="n">chef</span><span class="o">.</span><span class="n">recipe_url</span> <span class="o">=</span> <span class="s2">&quot;http://cloud.github.com/downloads/d0ugal/chef_recipes/cookbooks.tar.gz&quot;</span>
    <span class="n">chef</span><span class="o">.</span><span class="n">cookbooks_path</span> <span class="o">=</span> <span class="o">[</span><span class="ss">:vm</span><span class="p">,</span> <span class="s2">&quot;cookbooks&quot;</span><span class="o">]</span>

    <span class="n">chef</span><span class="o">.</span><span class="n">add_recipe</span> <span class="s2">&quot;main&quot;</span>
    <span class="n">chef</span><span class="o">.</span><span class="n">add_recipe</span> <span class="s2">&quot;python&quot;</span>
    <span class="n">chef</span><span class="o">.</span><span class="n">add_recipe</span> <span class="s2">&quot;postgres&quot;</span>

    <span class="n">chef</span><span class="o">.</span><span class="n">json</span><span class="o">.</span><span class="n">merge!</span><span class="p">({</span>

      <span class="ss">:project_name</span> <span class="o">=&gt;</span> <span class="s2">&quot;project_name&quot;</span><span class="p">,</span>

      <span class="ss">:system_packages</span> <span class="o">=&gt;</span> <span class="o">[]</span><span class="p">,</span>
      <span class="ss">:python_global_packages</span> <span class="o">=&gt;</span> <span class="o">[]</span><span class="p">,</span>
      <span class="ss">:python_packages</span> <span class="o">=&gt;</span> <span class="o">[]</span><span class="p">,</span>

    <span class="p">})</span>

  <span class="k">end</span>

<span class="k">end</span>
</pre></div>
<p>After copying in, look for project_name and change that to something on your
liking or you can just leave it for now.</p>
<blockquote>
If you have already been using vagrant, you will likely have the lucid box
already. The vagrant quick start tips download it and call it 'base' since
this is a common name I have changed it to something more explicit and
safe. However, to avoid re-downloading you may want to change lucid32 to
base in your config file.</blockquote>
<p>What does this do? It setups up a new Ubuntu Lucid machine and runs some
chef recipies against that are downloading from my chef github repository.
The base machine that its built on is downloaded from the url in the config
this is provided by the Vagrant team (I've not had a chance to make my own
boxes yet).</p>
<p>The Chef cookbook then installs some system wide packages, creates a virtual
environment, installs postgres and creates a database. These are not deploy
ready scripts but rather more hacky scripts to quickly bootstrap a development
env.</p>
<p>After saving, you can now do <cite>vagrant up</cite> this will take a while as it needs
to download the ubuntu box to create the VM from. The time delay is mostly
due to downloading of the box and also various packages like postgres so be
warned if you have a slow or limited connection, this is likely to sum up to
around 800mb or so.</p>
<p>After its finished, you should be able to do this.</p>
<div class="highlight"><pre><span></span>vagrant ssh
workon project_name
ls -la
</pre></div>
<p>You will then be running from the virtual machine, but be in an activated
Python virtual environment and in a directory that is mapped to the host
machine. Thus the result of that should show the files for the directory that
you started in. In my case I generally then need to do
<cite>pip install -r requirements.txt</cite> and after that I can run the project - be it
a Django website, or something different.</p>
<p>After this you can pretty much carry on as normal. There are a few things to
note that may effect you. Any tools that rely on accessing the Python
interpreter will not work as its not on a remote machine, I don't have a need
for this so I've not worked out a solution. I simply use the python debugger
directly in the ssh session. Editors like pyDev will likely loose some
functionality here but there may be a work around...</p>
<p>When using Django's runserver, you need to specify an IP address. I've created
a alias to make this easier. This assumes you are still connected to the
virtual machine but if not, cd into the project directory and run
<cite>vagrant ssh</cite>. How awesome is it to not need to remember IP's or logins?</p>
<div class="highlight"><pre><span></span>djr
# is the same as
python manage.py runserver 0.0.0.0:8000
</pre></div>
<p>These shortcuts are best left for another post perhaps, but some more can be
seen in my <a class="reference external" href="https://github.com/d0ugal/dotfiles">dotfiles repository</a>.</p>
<p>To access the site itself, you'll then need to go to the IP address specified
in the config file. In this case the full path will be
<cite>http://33.33.00.10:8000</cite> or since we have set the port forwarding in the
config above you should be able to go to localhost:8000.</p>
<p>I'm still working out my complete workflow for vagrant but I'm using this
machine as a base point for much of my work and creating a new machine for
each project. The best thing so far for me is a recorded development
environment that I can use to create a VM now or in 6 months when revisiting
an older project. My main problem at the moment is the effort required to
make big changes (new configs, new recipes etc.) but this should get easier
as I make more.</p>
<p>If you have any idea's or suggestions please let me know.</p>

      </div>
      <div class="span4 hidden-phone readinglist">
        <h4>Other recent posts ... </h4>
        <ul>
          <li><a href="/2014/Mar/02/python-glasgow-march-dojo/" rel="bookmark" title="Permanent Link to Python Glasgow March Dojo">
            Python Glasgow March Dojo
          </a></li>
          <li><a href="//notes/running-a-code-dojo/" rel="bookmark" title="Permanent Link to Running a Code Dojo">
            Running a Code Dojo
          </a></li>
          <li><a href="/2013/Nov/18/joining-red-hat/" rel="bookmark" title="Permanent Link to Joining Red Hat">
            Joining Red Hat
          </a></li>
          <li><a href="//notes/postgres-the-cool-stuff/" rel="bookmark" title="Permanent Link to PostgreSQL, The cool stuff.">
            PostgreSQL, The cool stuff.
          </a></li>
          <li><a href="//notes/sublimetext/" rel="bookmark" title="Permanent Link to SublimeText">
            SublimeText
          </a></li>
        </ul>
      </div>
    </div>
  </div><!-- /.entry-content -->

    <hr />

    <p>
      Thanks for reading. You should follow me on
      <a href="https://twitter.com/d0ugal">Twitter</a>.
    </p>

    <p>
      Do you have any feedback or comments? The best place for discussion is on
      <a href="//www.reddit.com/submit" onclick="window.location =
          '//www.reddit.com/submit?url=' + encodeURIComponent(window.location);
          return false">Reddit</a>
      or <a href="https://news.ycombinator.com/submit">Hacker News</a>.
      Otherwise, <a
          href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#100;&#111;&#117;&#103;&#97;&#108;&#64;&#100;&#111;&#117;&#103;&#97;&#108;&#109;&#97;&#116;&#116;&#104;&#101;&#119;&#115;&#46;&#99;&#111;&#109;">email
      me</a>.
    </p>

</section>

    </div>

  </div>

  <script src="/theme/js/bootstrap.min.js"></script>

  <script type="text/javascript">

    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-947562-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script');
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      ga.setAttribute('async', 'true');
      document.documentElement.firstChild.appendChild(ga);
    })();

  </script>
  <script src="/theme/js/anti-butt.js"></script>

</body>
</html>